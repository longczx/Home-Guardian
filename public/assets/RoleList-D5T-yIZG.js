import{a as S}from"./index-WsV9NrLY.js";import{a as U,b as M,e as q,f as F}from"./user-BD3AKPIZ.js";import{d as I,K as P,af as V,o as j,L as x,M as g,O as C,u as a,E as t,B as i,a3 as k,P as E,ag as L,r as c,D as N,U as v,a1 as f,V as $,ae as G,Q as K,R as y,S as _,ap as Q,a8 as H,a9 as J,h as r,ai as W,aq as X}from"./naive-ui-BdchKIzk.js";import{R as Y}from"./RefreshOutline-CFFu2u4W.js";import{A as Z,C as ee,T as ae}from"./TrashOutline-CiYK4OLL.js";import"./request-DAKZCXKs.js";const se={class:"flex items-center justify-between mb-4"},te={class:"grid grid-cols-2 gap-1"},ce=I({__name:"RoleList",setup(le){const o=P(),R=V(),b=S(),p=c(!1),h=c([]),u=c(!1),d=c(null),n=c({name:"",display_name:"",description:"",permissions:[]}),D=["devices.view","devices.create","devices.edit","devices.delete","alerts.view","alerts.create","alerts.edit","alerts.delete","users.view","users.create","users.edit","users.delete","dashboards.view","dashboards.create","dashboards.edit","dashboards.delete","commands.send"],z=[{title:"ID",key:"id",width:60},{title:"标识",key:"name",width:120},{title:"显示名",key:"display_name",width:120},{title:"描述",key:"description",ellipsis:!0},{title:"权限",key:"permissions",ellipsis:!0,render:s=>{const e=s.permissions||[],l=Array.isArray(e)?e:Object.keys(e);return r(k,{size:4},()=>l.slice(0,5).map(w=>r(W,{size:"tiny",bordered:!1,key:w},()=>w)).concat(l.length>5?[r("span",{key:"more"},`+${l.length-5}`)]:[]))}},{title:"用户数",key:"users_count",width:80},{title:"操作",key:"actions",width:100,render:s=>s.name==="admin"?null:r(k,{size:4},()=>[r(v,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>O(s)},{icon:()=>r(f,null,()=>r(ee))}),r(v,{size:"tiny",quaternary:!0,type:"error",onClick:()=>B(s)},{icon:()=>r(f,null,()=>r(ae))})])}];async function m(){var s;p.value=!0;try{const e=await U();h.value=((s=e.data)==null?void 0:s.data)||e.data||[]}catch{o.error("加载失败")}finally{p.value=!1}}function A(){d.value=null,n.value={name:"",display_name:"",description:"",permissions:[]},u.value=!0}function O(s){d.value=s;const e=s.permissions||[];n.value={name:s.name,display_name:s.display_name||"",description:s.description||"",permissions:Array.isArray(e)?e:Object.keys(e)},u.value=!0}async function T(){var s,e;try{d.value?(await q(d.value.id,n.value),o.success("已更新")):(await F(n.value),o.success("已创建")),u.value=!1,m()}catch(l){o.error(((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||"操作失败")}}function B(s){R.warning({title:"确认删除",content:`确定要删除角色 "${s.display_name||s.name}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await M(s.id),o.success("已删除"),m()}catch{o.error("删除失败")}}})}return j(m),(s,e)=>(N(),x("div",null,[g("div",se,[g("h2",{class:"text-lg font-semibold",style:C({color:a(b).isDark?"#fff":"#1a1a1a"})}," 角色管理 ",4),t(a(k),null,{default:i(()=>[t(a(v),{quaternary:"",circle:"",onClick:m,loading:p.value},{icon:i(()=>[t(a(f),null,{default:i(()=>[t(a(Y))]),_:1})]),_:1},8,["loading"]),t(a(v),{type:"primary",onClick:A},{icon:i(()=>[t(a(f),null,{default:i(()=>[t(a(Z))]),_:1})]),default:i(()=>[e[5]||(e[5]=$(" 创建角色 ",-1))]),_:1})]),_:1})]),t(a(E),{style:C({backgroundColor:a(b).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:a(b).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:i(()=>[t(a(G),{columns:z,data:h.value,loading:p.value,bordered:!1,striped:"",size:"small"},null,8,["data","loading"])]),_:1},8,["style"]),t(a(L),{show:u.value,"onUpdate:show":e[4]||(e[4]=l=>u.value=l),preset:"dialog",title:d.value?"编辑角色":"创建角色","positive-text":"保存","negative-text":"取消",onPositiveClick:T,style:{width:"560px"}},{default:i(()=>[t(a(K),{model:n.value,"label-placement":"left","label-width":"80"},{default:i(()=>[t(a(y),{label:"标识"},{default:i(()=>[t(a(_),{value:n.value.name,"onUpdate:value":e[0]||(e[0]=l=>n.value.name=l),disabled:!!d.value,placeholder:"如 editor"},null,8,["value","disabled"])]),_:1}),t(a(y),{label:"显示名"},{default:i(()=>[t(a(_),{value:n.value.display_name,"onUpdate:value":e[1]||(e[1]=l=>n.value.display_name=l),placeholder:"如 编辑者"},null,8,["value"])]),_:1}),t(a(y),{label:"描述"},{default:i(()=>[t(a(_),{value:n.value.description,"onUpdate:value":e[2]||(e[2]=l=>n.value.description=l)},null,8,["value"])]),_:1}),t(a(y),{label:"权限"},{default:i(()=>[t(a(Q),{value:n.value.permissions,"onUpdate:value":e[3]||(e[3]=l=>n.value.permissions=l)},{default:i(()=>[g("div",te,[(N(),x(H,null,J(D,l=>t(a(X),{key:l,value:l,label:l},null,8,["value","label"])),64))])]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}});export{ce as default};
