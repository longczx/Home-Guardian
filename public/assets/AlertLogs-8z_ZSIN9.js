import{a as j}from"./index-WsV9NrLY.js";import{a as A,b as $,r as R}from"./alert-Dubs-O-k.js";import{d as C,D as h,L as m,M as n,K as P,o as T,O as z,u as a,E as s,B as k,U as y,P as U,r as d,a1 as x,a3 as N,ah as V,ae as E,ao as I,Y as q,h as l,ai as M}from"./naive-ui-BdchKIzk.js";import{R as F}from"./RefreshOutline-CFFu2u4W.js";import"./request-DAKZCXKs.js";const K={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Y=n("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),G=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M352 176L217.6 336L160 272"},null,-1),H=[Y,G],J=C({name:"CheckmarkCircleOutline",render:function(r,c){return h(),m("svg",K,H)}}),Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},W=n("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),X=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 192L256.13 320l-47.95-48"},null,-1),Z=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M191.95 320L144 272"},null,-1),ee=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M305.71 192l-51.55 59"},null,-1),te=[W,X,Z,ee],ae=C({name:"CheckmarkDoneCircleOutline",render:function(r,c){return h(),m("svg",Q,te)}}),le={class:"flex items-center justify-between mb-4"},se={key:0,class:"flex justify-end mt-4"},ce=C({__name:"AlertLogs",setup(b){const r=P(),c=j(),p=d(!1),f=d([]),v=d(0),_=d(1),w=d(20),g=d(null),S=[{label:"全部状态",value:""},{label:"已触发",value:"triggered"},{label:"已确认",value:"acknowledged"},{label:"已解决",value:"resolved"}],B=[{title:"ID",key:"id",width:60},{title:"时间",key:"triggered_at",width:170,render:e=>{var t;return((t=e.triggered_at)==null?void 0:t.replace("T"," ").slice(0,19))||"-"}},{title:"规则",key:"rule_name",width:140,ellipsis:!0,render:e=>{var t;return((t=e.alert_rule)==null?void 0:t.name)||e.rule_name||"-"}},{title:"设备",key:"device_name",width:120,ellipsis:!0,render:e=>{var t;return((t=e.device)==null?void 0:t.name)||e.device_name||"-"}},{title:"级别",key:"severity",width:80,render:e=>{var i;const t=((i=e.alert_rule)==null?void 0:i.severity)||e.severity||"info";return l(M,{size:"small",type:{info:"info",warning:"warning",critical:"error"}[t]||"default",bordered:!1},()=>t)}},{title:"消息",key:"message",ellipsis:!0},{title:"指标值",key:"metric_value",width:80},{title:"状态",key:"status",width:90,render:e=>l(M,{size:"small",type:{triggered:"error",acknowledged:"warning",resolved:"success"}[e.status]||"default",bordered:!1},()=>e.status)},{title:"操作",key:"actions",width:140,render:e=>l(N,{size:4},()=>[e.status==="triggered"&&l(y,{size:"tiny",type:"warning",secondary:!0,onClick:()=>L(e.id)},{default:()=>"确认",icon:()=>l(x,null,()=>l(J))}),(e.status==="triggered"||e.status==="acknowledged")&&l(y,{size:"tiny",type:"success",secondary:!0,onClick:()=>D(e.id)},{default:()=>"解决",icon:()=>l(x,null,()=>l(ae))})])}];async function o(){var e,t;p.value=!0;try{const u={page:_.value,per_page:w.value};g.value&&(u.status=g.value);const i=await A(u);f.value=((e=i.data)==null?void 0:e.data)||i.data||[],v.value=((t=i.data)==null?void 0:t.total)||f.value.length}catch{r.error("加载告警日志失败")}finally{p.value=!1}}async function L(e){try{await $(e),r.success("告警已确认"),o()}catch{r.error("操作失败")}}async function D(e){try{await R(e),r.success("告警已解决"),o()}catch{r.error("操作失败")}}function O(e){_.value=e,o()}return T(o),(e,t)=>(h(),m("div",null,[n("div",le,[n("h2",{class:"text-lg font-semibold",style:z({color:a(c).isDark?"#fff":"#1a1a1a"})}," 告警日志 ",4),s(a(y),{quaternary:"",circle:"",onClick:o,loading:p.value},{icon:k(()=>[s(a(x),null,{default:k(()=>[s(a(F))]),_:1})]),_:1},8,["loading"])]),s(a(U),{style:z({backgroundColor:a(c).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:a(c).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:k(()=>[s(a(N),{class:"mb-4"},{default:k(()=>[s(a(V),{value:g.value,"onUpdate:value":[t[0]||(t[0]=u=>g.value=u),o],options:S,style:{width:"150px"}},null,8,["value"])]),_:1}),s(a(E),{columns:B,data:f.value,loading:p.value,bordered:!1,striped:"",size:"small"},null,8,["data","loading"]),v.value>w.value?(h(),m("div",se,[s(a(I),{page:_.value,"page-size":w.value,"item-count":v.value,"onUpdate:page":O},null,8,["page","page-size","item-count"])])):q("",!0)]),_:1},8,["style"])]))}});export{ce as default};
