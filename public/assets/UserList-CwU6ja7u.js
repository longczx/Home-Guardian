import{a as V}from"./index-WsV9NrLY.js";import{g as q,a as A,d as E,u as F,c as P}from"./user-BD3AKPIZ.js";import{d as L,K as j,af as K,o as Q,L as $,M as x,O as C,u as t,E as s,B as n,a3 as w,P as G,ag as H,r,D as J,U as b,a1 as k,V as W,S as v,ae as X,Q as Y,R as d,ah as N,h as i,ai as z}from"./naive-ui-BdchKIzk.js";import{R as Z}from"./RefreshOutline-CFFu2u4W.js";import{A as ee,C as ae,T as le}from"./TrashOutline-CiYK4OLL.js";import"./request-DAKZCXKs.js";const te={class:"flex items-center justify-between mb-4"},pe=L({__name:"UserList",setup(se){const p=j(),D=K(),g=V(),f=r(!1),_=r([]),U=r([]),y=r(""),c=r(!1),u=r(null),o=r({username:"",password:"",nickname:"",email:"",phone:"",status:"active",role_ids:[],allowed_locations:[]}),T=[{label:"活跃",value:"active"},{label:"禁用",value:"disabled"}],O=[{title:"ID",key:"id",width:60},{title:"用户名",key:"username",width:120},{title:"昵称",key:"nickname",width:120,ellipsis:!0},{title:"邮箱",key:"email",ellipsis:!0},{title:"角色",key:"roles",width:150,render:l=>{const e=l.roles||[];return i(w,{size:4},()=>e.map(a=>i(z,{size:"small",bordered:!1,key:a.id||a},()=>a.display_name||a.name||a)))}},{title:"状态",key:"status",width:80,render:l=>i(z,{size:"small",bordered:!1,type:l.status==="active"?"success":"error"},()=>l.status==="active"?"活跃":"禁用")},{title:"创建时间",key:"created_at",width:170,render:l=>{var e;return((e=l.created_at)==null?void 0:e.replace("T"," ").slice(0,19))||"-"}},{title:"操作",key:"actions",width:100,render:l=>i(w,{size:4},()=>[i(b,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>R(l)},{icon:()=>i(k,null,()=>i(ae))}),i(b,{size:"tiny",quaternary:!0,type:"error",onClick:()=>I(l)},{icon:()=>i(k,null,()=>i(le))})])}];async function m(){var l;f.value=!0;try{const e={per_page:100};y.value&&(e.search=y.value);const a=await q(e);_.value=((l=a.data)==null?void 0:l.data)||a.data||[]}catch{p.error("加载失败")}finally{f.value=!1}}async function S(){var l;try{const e=await A(),a=((l=e.data)==null?void 0:l.data)||e.data||[];U.value=a.map(h=>({label:h.display_name||h.name,value:h.id}))}catch{}}function B(){u.value=null,o.value={username:"",password:"",nickname:"",email:"",phone:"",status:"active",role_ids:[],allowed_locations:[]},c.value=!0}function R(l){u.value=l,o.value={username:l.username,password:"",nickname:l.nickname||"",email:l.email||"",phone:l.phone||"",status:l.status,role_ids:(l.roles||[]).map(e=>e.id),allowed_locations:l.allowed_locations||[]},c.value=!0}async function M(){var l,e;try{const a={...o.value};u.value&&!a.password&&delete a.password,u.value?(await F(u.value.id,a),p.success("用户已更新")):(await P(a),p.success("用户已创建")),c.value=!1,m()}catch(a){p.error(((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"操作失败")}}function I(l){D.warning({title:"确认删除",content:`确定要删除用户 "${l.username}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await E(l.id),p.success("已删除"),m()}catch{p.error("删除失败")}}})}return Q(()=>{m(),S()}),(l,e)=>(J(),$("div",null,[x("div",te,[x("h2",{class:"text-lg font-semibold",style:C({color:t(g).isDark?"#fff":"#1a1a1a"})}," 用户管理 ",4),s(t(w),null,{default:n(()=>[s(t(b),{quaternary:"",circle:"",onClick:m,loading:f.value},{icon:n(()=>[s(t(k),null,{default:n(()=>[s(t(Z))]),_:1})]),_:1},8,["loading"]),s(t(b),{type:"primary",onClick:B},{icon:n(()=>[s(t(k),null,{default:n(()=>[s(t(ee))]),_:1})]),default:n(()=>[e[9]||(e[9]=W(" 添加用户 ",-1))]),_:1})]),_:1})]),s(t(G),{style:C({backgroundColor:t(g).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:t(g).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:n(()=>[s(t(w),{class:"mb-4"},{default:n(()=>[s(t(v),{value:y.value,"onUpdate:value":[e[0]||(e[0]=a=>y.value=a),m],placeholder:"搜索用户...",clearable:"",style:{width:"240px"}},null,8,["value"])]),_:1}),s(t(X),{columns:O,data:_.value,loading:f.value,bordered:!1,striped:"",size:"small"},null,8,["data","loading"])]),_:1},8,["style"]),s(t(H),{show:c.value,"onUpdate:show":e[8]||(e[8]=a=>c.value=a),preset:"dialog",title:u.value?"编辑用户":"添加用户","positive-text":"保存","negative-text":"取消",onPositiveClick:M,style:{width:"520px"}},{default:n(()=>[s(t(Y),{model:o.value,"label-placement":"left","label-width":"80"},{default:n(()=>[s(t(d),{label:"用户名"},{default:n(()=>[s(t(v),{value:o.value.username,"onUpdate:value":e[1]||(e[1]=a=>o.value.username=a),disabled:!!u.value},null,8,["value","disabled"])]),_:1}),s(t(d),{label:u.value?"新密码":"密码"},{default:n(()=>[s(t(v),{value:o.value.password,"onUpdate:value":e[2]||(e[2]=a=>o.value.password=a),type:"password","show-password-on":"click",placeholder:u.value?"留空则不修改":"输入密码"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(t(d),{label:"昵称"},{default:n(()=>[s(t(v),{value:o.value.nickname,"onUpdate:value":e[3]||(e[3]=a=>o.value.nickname=a)},null,8,["value"])]),_:1}),s(t(d),{label:"邮箱"},{default:n(()=>[s(t(v),{value:o.value.email,"onUpdate:value":e[4]||(e[4]=a=>o.value.email=a)},null,8,["value"])]),_:1}),s(t(d),{label:"手机"},{default:n(()=>[s(t(v),{value:o.value.phone,"onUpdate:value":e[5]||(e[5]=a=>o.value.phone=a)},null,8,["value"])]),_:1}),s(t(d),{label:"状态"},{default:n(()=>[s(t(N),{value:o.value.status,"onUpdate:value":e[6]||(e[6]=a=>o.value.status=a),options:T},null,8,["value"])]),_:1}),s(t(d),{label:"角色"},{default:n(()=>[s(t(N),{value:o.value.role_ids,"onUpdate:value":e[7]||(e[7]=a=>o.value.role_ids=a),options:U.value,multiple:"",placeholder:"选择角色"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}});export{pe as default};
