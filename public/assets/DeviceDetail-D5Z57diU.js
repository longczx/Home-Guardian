import{a as J,c as P,b as q}from"./index-WsV9NrLY.js";import{_ as K}from"./StatusBadge.vue_vue_type_script_setup_true_lang-CSbWFjI_.js";import{_ as Q}from"./TimeRangePicker.vue_vue_type_script_setup_true_lang-DMQdOESZ.js";import{a as Y,b as G,e as H,s as W}from"./device-enMWkg-k.js";import{r as X}from"./request-DAKZCXKs.js";import{d as S,D as c,L as b,M as k,K as Z,o as ee,E as a,B as l,u as e,U as O,O as f,a2 as i,z as h,Y as B,ac as ae,ag as te,r as v,a1 as T,P as w,aj as z,ak as p,V as u,a8 as le,a9 as se,ae as L,ad as re,Q as oe,R as V,S as I,h as ne,ai as de}from"./naive-ui-BdchKIzk.js";const ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M244 400L100 256l144-144"},null,-1),ce=k("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M120 256h292"},null,-1),me=[ue,ce],pe=S({name:"ArrowBackOutline",render:function(x,C){return c(),b("svg",ie,me)}}),ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},_e=k("path",{d:"M470.3 271.15L43.16 447.31a7.83 7.83 0 0 1-11.16-7V327a8 8 0 0 1 6.51-7.86l247.62-47c17.36-3.29 17.36-28.15 0-31.44l-247.63-47a8 8 0 0 1-6.5-7.85V72.59c0-5.74 5.88-10.26 11.16-8L470.3 241.76a16 16 0 0 1 0 29.39z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),fe=[_e],be=S({name:"SendOutline",render:function(x,C){return c(),b("svg",ve,fe)}}),ke={class:"flex items-center gap-3 mb-4"},ye={key:0,class:"space-y-4"},De=S({__name:"DeviceDetail",setup(R){const x=P(),C=q(),N=Z(),d=J(),_=Number(x.params.id),o=v(null),D=v([]),$=v([]),F=v([]),y=v(!0),g=v(!1),m=v({command:"",params:"{}"});async function M(){var r;y.value=!0;try{const[t,n,s]=await Promise.all([Y(_),G(_),H({device_id:_,per_page:10})]);o.value=t.data,D.value=n.data||[],F.value=((r=s.data)==null?void 0:r.data)||s.data||[]}catch{N.error("加载设备信息失败")}finally{y.value=!1}}async function j(r){var t;try{const n=await X.get("/telemetry",{params:{device_id:_,start_time:r.start,end_time:r.end,per_page:100}});$.value=((t=n.data)==null?void 0:t.data)||n.data||[]}catch{}}async function A(){var r,t;try{let n={};try{n=JSON.parse(m.value.params)}catch{}await W(_,{command:m.value.command,params:n}),N.success("指令已发送"),g.value=!1,m.value={command:"",params:"{}"},M()}catch(n){N.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"发送失败")}}const U=[{title:"时间",key:"recorded_at",width:170,render:r=>{var t;return((t=r.recorded_at||r.timestamp)==null?void 0:t.replace("T"," ").slice(0,19))||"-"}},{title:"指标",key:"metric",width:120},{title:"值",key:"value",width:120},{title:"单位",key:"unit",width:80}],E=[{title:"时间",key:"created_at",width:170,render:r=>{var t;return((t=r.created_at)==null?void 0:t.replace("T"," ").slice(0,19))||"-"}},{title:"指令",key:"command",width:150},{title:"参数",key:"params",ellipsis:!0,render:r=>JSON.stringify(r.params||{})},{title:"状态",key:"status",width:100,render:r=>ne(de,{size:"small",type:{success:"success",failed:"error",pending:"warning",sent:"info"}[r.status]||"default",bordered:!1},()=>r.status)}];return ee(M),(r,t)=>{var n;return c(),b("div",null,[k("div",ke,[a(e(O),{quaternary:"",circle:"",onClick:t[0]||(t[0]=s=>e(C).back())},{icon:l(()=>[a(e(T),null,{default:l(()=>[a(e(pe))]),_:1})]),_:1}),k("h2",{class:"text-lg font-semibold",style:f({color:e(d).isDark?"#fff":"#1a1a1a"})},i(((n=o.value)==null?void 0:n.name)||"设备详情"),5),o.value?(c(),h(K,{key:0,status:o.value.status},null,8,["status"])):B("",!0)]),a(e(ae),{show:y.value},{default:l(()=>[o.value?(c(),b("div",ye,[a(e(w),{title:"基本信息",style:f({backgroundColor:e(d).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:e(d).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:l(()=>[a(e(z),{column:3,"label-placement":"left"},{default:l(()=>[a(e(p),{label:"ID"},{default:l(()=>[u(i(o.value.id),1)]),_:1}),a(e(p),{label:"名称"},{default:l(()=>[u(i(o.value.name),1)]),_:1}),a(e(p),{label:"类型"},{default:l(()=>[u(i(o.value.type),1)]),_:1}),a(e(p),{label:"Device Key"},{default:l(()=>[u(i(o.value.device_key),1)]),_:1}),a(e(p),{label:"位置"},{default:l(()=>[u(i(o.value.location||"-"),1)]),_:1}),a(e(p),{label:"最后在线"},{default:l(()=>{var s;return[u(i(((s=o.value.last_seen_at)==null?void 0:s.replace("T"," ").slice(0,19))||"-"),1)]}),_:1}),a(e(p),{label:"创建时间"},{default:l(()=>{var s;return[u(i(((s=o.value.created_at)==null?void 0:s.replace("T"," ").slice(0,19))||"-"),1)]}),_:1})]),_:1})]),_:1},8,["style"]),D.value.length?(c(),h(e(w),{key:0,title:"设备属性",style:f({backgroundColor:e(d).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:e(d).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:l(()=>[a(e(z),{column:3,"label-placement":"left"},{default:l(()=>[(c(!0),b(le,null,se(D.value,s=>(c(),h(e(p),{key:s.key||s.attribute_key,label:s.key||s.attribute_key},{default:l(()=>[u(i(s.value||s.attribute_value),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["style"])):B("",!0),a(e(w),{title:"遥测数据",style:f({backgroundColor:e(d).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:e(d).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{"header-extra":l(()=>[a(Q,{onChange:j})]),default:l(()=>[a(e(L),{columns:U,data:$.value,bordered:!1,size:"small","max-height":"400"},null,8,["data"])]),_:1},8,["style"]),a(e(w),{title:"指令历史",style:f({backgroundColor:e(d).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:e(d).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{"header-extra":l(()=>[a(e(O),{size:"small",type:"primary",onClick:t[1]||(t[1]=s=>g.value=!0)},{icon:l(()=>[a(e(T),null,{default:l(()=>[a(e(be))]),_:1})]),default:l(()=>[t[5]||(t[5]=u(" 发送指令 ",-1))]),_:1})]),default:l(()=>[a(e(L),{columns:E,data:F.value,bordered:!1,size:"small"},null,8,["data"])]),_:1},8,["style"])])):y.value?B("",!0):(c(),h(e(re),{key:1,description:"设备不存在"}))]),_:1},8,["show"]),a(e(te),{show:g.value,"onUpdate:show":t[4]||(t[4]=s=>g.value=s),preset:"dialog",title:"发送指令","positive-text":"发送","negative-text":"取消",onPositiveClick:A,style:{width:"480px"}},{default:l(()=>[a(e(oe),{model:m.value,"label-placement":"left","label-width":"60"},{default:l(()=>[a(e(V),{label:"指令",path:"command"},{default:l(()=>[a(e(I),{value:m.value.command,"onUpdate:value":t[2]||(t[2]=s=>m.value.command=s),placeholder:"输入指令名称"},null,8,["value"])]),_:1}),a(e(V),{label:"参数",path:"params"},{default:l(()=>[a(e(I),{value:m.value.params,"onUpdate:value":t[3]||(t[3]=s=>m.value.params=s),type:"textarea",placeholder:'JSON 格式参数，如 {"key": "value"}',rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}});export{De as default};
