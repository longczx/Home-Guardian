import{a as R}from"./index-WsV9NrLY.js";import{r as m}from"./request-DAKZCXKs.js";import{d as T,D as z,L as D,M as b,K as j,af as A,o as F,O as _,u as t,E as l,B as i,a3 as N,P as J,ag as L,r as f,U as p,a1 as v,V as K,ae as Q,Q as W,R as h,S as x,ah as G,al as O,h as r,ai as H}from"./naive-ui-BdchKIzk.js";import{R as X}from"./RefreshOutline-CFFu2u4W.js";import{A as Y,C as Z,T as ee}from"./TrashOutline-CiYK4OLL.js";const ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},te=b("path",{d:"M53.12 199.94l400-151.39a8 8 0 0 1 10.33 10.33l-151.39 400a8 8 0 0 1-15-.34l-67.4-166.09a16 16 0 0 0-10.11-10.11L53.46 215a8 8 0 0 1-.34-15.06z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),le=b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M460 52L227 285"},null,-1),ne=[te,le],oe=T({name:"PaperPlaneOutline",render:function(s,w){return z(),D("svg",ae,ne)}});function ie(u){return m.get("/notification-channels",{params:u})}function se(u){return m.post("/notification-channels",u)}function S(u,s){return m.put(`/notification-channels/${u}`,s)}function re(u){return m.delete(`/notification-channels/${u}`)}function ue(u){return m.post(`/notification-channels/${u}/test`)}const de={class:"flex items-center justify-between mb-4"},ye=T({__name:"NotificationChannels",setup(u){const s=j(),w=A(),k=R(),y=f(!1),C=f([]),d=f(!1),c=f(null),o=f({name:"",type:"email",config:"{}",enabled:!0}),B=[{label:"邮件",value:"email"},{label:"Webhook",value:"webhook"},{label:"企业微信",value:"wechat_work"},{label:"钉钉",value:"dingtalk"},{label:"Telegram",value:"telegram"}],M=[{title:"ID",key:"id",width:60},{title:"名称",key:"name",ellipsis:!0},{title:"类型",key:"type",width:100,render:e=>r(H,{size:"small",bordered:!1},()=>e.type)},{title:"启用",key:"enabled",width:80,render:e=>r(O,{size:"small",value:e.enabled,onUpdateValue:a=>$(e,a)})},{title:"创建时间",key:"created_at",width:170,render:e=>{var a;return((a=e.created_at)==null?void 0:a.replace("T"," ").slice(0,19))||"-"}},{title:"操作",key:"actions",width:160,render:e=>r(N,{size:4},()=>[r(p,{size:"tiny",type:"info",secondary:!0,onClick:()=>q(e.id)},{default:()=>"测试",icon:()=>r(v,null,()=>r(oe))}),r(p,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>U(e)},{icon:()=>r(v,null,()=>r(Z))}),r(p,{size:"tiny",quaternary:!0,type:"error",onClick:()=>E(e)},{icon:()=>r(v,null,()=>r(ee))})])}];async function g(){var e;y.value=!0;try{const a=await ie({per_page:100});C.value=((e=a.data)==null?void 0:e.data)||a.data||[]}catch{s.error("加载失败")}finally{y.value=!1}}function P(){c.value=null,o.value={name:"",type:"email",config:"{}",enabled:!0},d.value=!0}function U(e){c.value=e,o.value={name:e.name,type:e.type,config:JSON.stringify(e.config||{},null,2),enabled:e.enabled},d.value=!0}async function V(){var e,a;try{const n={...o.value,config:JSON.parse(o.value.config)};c.value?(await S(c.value.id,n),s.success("已更新")):(await se(n),s.success("已创建")),d.value=!1,g()}catch(n){s.error(((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"操作失败")}}async function $(e,a){try{await S(e.id,{...e,enabled:a}),e.enabled=a}catch{s.error("更新失败")}}async function q(e){var a,n;try{await ue(e),s.success("测试通知已发送")}catch(I){s.error(((n=(a=I.response)==null?void 0:a.data)==null?void 0:n.message)||"测试发送失败")}}function E(e){w.warning({title:"确认删除",content:`确定要删除渠道 "${e.name}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await re(e.id),s.success("已删除"),g()}catch{s.error("删除失败")}}})}return F(g),(e,a)=>(z(),D("div",null,[b("div",de,[b("h2",{class:"text-lg font-semibold",style:_({color:t(k).isDark?"#fff":"#1a1a1a"})}," 通知渠道 ",4),l(t(N),null,{default:i(()=>[l(t(p),{quaternary:"",circle:"",onClick:g,loading:y.value},{icon:i(()=>[l(t(v),null,{default:i(()=>[l(t(X))]),_:1})]),_:1},8,["loading"]),l(t(p),{type:"primary",onClick:P},{icon:i(()=>[l(t(v),null,{default:i(()=>[l(t(Y))]),_:1})]),default:i(()=>[a[5]||(a[5]=K(" 添加渠道 ",-1))]),_:1})]),_:1})]),l(t(J),{style:_({backgroundColor:t(k).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:t(k).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:i(()=>[l(t(Q),{columns:M,data:C.value,loading:y.value,bordered:!1,striped:"",size:"small"},null,8,["data","loading"])]),_:1},8,["style"]),l(t(L),{show:d.value,"onUpdate:show":a[4]||(a[4]=n=>d.value=n),preset:"dialog",title:c.value?"编辑渠道":"添加渠道","positive-text":"保存","negative-text":"取消",onPositiveClick:V,style:{width:"520px"}},{default:i(()=>[l(t(W),{model:o.value,"label-placement":"left","label-width":"80"},{default:i(()=>[l(t(h),{label:"名称"},{default:i(()=>[l(t(x),{value:o.value.name,"onUpdate:value":a[0]||(a[0]=n=>o.value.name=n),placeholder:"渠道名称"},null,8,["value"])]),_:1}),l(t(h),{label:"类型"},{default:i(()=>[l(t(G),{value:o.value.type,"onUpdate:value":a[1]||(a[1]=n=>o.value.type=n),options:B},null,8,["value"])]),_:1}),l(t(h),{label:"配置"},{default:i(()=>[l(t(x),{value:o.value.config,"onUpdate:value":a[2]||(a[2]=n=>o.value.config=n),type:"textarea",rows:5,placeholder:"JSON 配置"},null,8,["value"])]),_:1}),l(t(h),{label:"启用"},{default:i(()=>[l(t(O),{value:o.value.enabled,"onUpdate:value":a[3]||(a[3]=n=>o.value.enabled=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}});export{ye as default};
