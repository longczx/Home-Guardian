import{a as U}from"./index-WsV9NrLY.js";import{r as v}from"./request-DAKZCXKs.js";import{d as E,K as M,af as V,o as q,L as I,M as w,O as N,u as e,E as l,B as i,a3 as x,P as R,ag as A,r as p,D as h,U as m,a1 as y,V as F,ae as J,z as P,ad as $,Y as j,Q as K,R as g,S as k,al as L,h as r,ai as C}from"./naive-ui-BdchKIzk.js";import{R as Q}from"./RefreshOutline-CFFu2u4W.js";import{A as Y,C as G,T as H}from"./TrashOutline-CiYK4OLL.js";const W={class:"flex items-center justify-between mb-4"},se=E({__name:"DashboardEditor",setup(X){const n=M(),D=V(),b=U(),u=p(!1),_=p([]),d=p(!1),c=p(null),o=p({name:"",description:"",layout:"[]",is_default:!1}),S=[{title:"ID",key:"id",width:60},{title:"名称",key:"name",ellipsis:!0},{title:"描述",key:"description",ellipsis:!0},{title:"默认",key:"is_default",width:80,render:a=>a.is_default?r(C,{size:"small",type:"success",bordered:!1},()=>"是"):r(C,{size:"small",bordered:!1},()=>"否")},{title:"创建时间",key:"created_at",width:170,render:a=>{var t;return((t=a.created_at)==null?void 0:t.replace("T"," ").slice(0,19))||"-"}},{title:"操作",key:"actions",width:100,render:a=>r(x,{size:4},()=>[r(m,{size:"tiny",quaternary:!0,type:"primary",onClick:()=>O(a)},{icon:()=>r(y,null,()=>r(G))}),r(m,{size:"tiny",quaternary:!0,type:"error",onClick:()=>B(a)},{icon:()=>r(y,null,()=>r(H))})])}];async function f(){var a;u.value=!0;try{const t=await v.get("/dashboards",{params:{per_page:100}});_.value=((a=t.data)==null?void 0:a.data)||t.data||[]}catch{n.error("加载失败")}finally{u.value=!1}}function z(){c.value=null,o.value={name:"",description:"",layout:"[]",is_default:!1},d.value=!0}function O(a){c.value=a,o.value={name:a.name,description:a.description||"",layout:JSON.stringify(a.layout||[],null,2),is_default:a.is_default||!1},d.value=!0}async function T(){var a,t;try{const s={...o.value,layout:JSON.parse(o.value.layout)};c.value?(await v.put(`/dashboards/${c.value.id}`,s),n.success("已更新")):(await v.post("/dashboards",s),n.success("已创建")),d.value=!1,f()}catch(s){n.error(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||"操作失败")}}function B(a){D.warning({title:"确认删除",content:`确定要删除仪表盘 "${a.name}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await v.delete(`/dashboards/${a.id}`),n.success("已删除"),f()}catch{n.error("删除失败")}}})}return q(f),(a,t)=>(h(),I("div",null,[w("div",W,[w("h2",{class:"text-lg font-semibold",style:N({color:e(b).isDark?"#fff":"#1a1a1a"})}," 自定义仪表盘 ",4),l(e(x),null,{default:i(()=>[l(e(m),{quaternary:"",circle:"",onClick:f,loading:u.value},{icon:i(()=>[l(e(y),null,{default:i(()=>[l(e(Q))]),_:1})]),_:1},8,["loading"]),l(e(m),{type:"primary",onClick:z},{icon:i(()=>[l(e(y),null,{default:i(()=>[l(e(Y))]),_:1})]),default:i(()=>[t[5]||(t[5]=F(" 创建仪表盘 ",-1))]),_:1})]),_:1})]),l(e(R),{style:N({backgroundColor:e(b).cardBg,backdropFilter:"blur(12px)",borderRadius:"12px",border:e(b).isDark?"1px solid rgba(255,255,255,0.06)":"1px solid rgba(0,0,0,0.06)"})},{default:i(()=>[l(e(J),{columns:S,data:_.value,loading:u.value,bordered:!1,striped:"",size:"small"},null,8,["data","loading"]),_.value.length===0&&!u.value?(h(),P(e($),{key:0,description:"暂无自定义仪表盘",class:"py-8"})):j("",!0)]),_:1},8,["style"]),l(e(A),{show:d.value,"onUpdate:show":t[4]||(t[4]=s=>d.value=s),preset:"dialog",title:c.value?"编辑仪表盘":"创建仪表盘","positive-text":"保存","negative-text":"取消",onPositiveClick:T,style:{width:"600px"}},{default:i(()=>[l(e(K),{model:o.value,"label-placement":"left","label-width":"80"},{default:i(()=>[l(e(g),{label:"名称"},{default:i(()=>[l(e(k),{value:o.value.name,"onUpdate:value":t[0]||(t[0]=s=>o.value.name=s),placeholder:"仪表盘名称"},null,8,["value"])]),_:1}),l(e(g),{label:"描述"},{default:i(()=>[l(e(k),{value:o.value.description,"onUpdate:value":t[1]||(t[1]=s=>o.value.description=s),type:"textarea",rows:2},null,8,["value"])]),_:1}),l(e(g),{label:"布局配置"},{default:i(()=>[l(e(k),{value:o.value.layout,"onUpdate:value":t[2]||(t[2]=s=>o.value.layout=s),type:"textarea",rows:8,placeholder:"JSON 布局配置数组",style:{"font-family":"monospace"}},null,8,["value"])]),_:1}),l(e(g),{label:"设为默认"},{default:i(()=>[l(e(L),{value:o.value.is_default,"onUpdate:value":t[3]||(t[3]=s=>o.value.is_default=s)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]))}});export{se as default};
