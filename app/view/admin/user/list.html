{extend name="admin/layout" /}
{block name="content"}
<div class="layui-card">
    <div class="layui-card-header">
        用户管理
        <a href="/admin/users/create" class="layui-btn layui-btn-sm layui-btn-normal" style="float:right;margin-top:3px;">
            <i class="layui-icon layui-icon-add-1"></i> 添加用户
        </a>
    </div>
    <div class="layui-card-body">
        <form class="layui-form" method="get" style="margin-bottom:15px;">
            <div class="layui-inline">
                <input type="text" name="keyword" placeholder="搜索用户名/姓名/邮箱" value="{{$filters['keyword'] ?? ''}}" class="layui-input" style="width:220px;">
            </div>
            <div class="layui-inline">
                <button class="layui-btn layui-btn-sm" lay-submit>筛选</button>
                <a href="/admin/users" class="layui-btn layui-btn-sm layui-btn-primary">重置</a>
            </div>
        </form>

        <table class="layui-table" lay-skin="line">
            <colgroup><col width="60"><col><col><col><col width="80"><col width="80"><col width="150"></colgroup>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>用户名</th>
                    <th>姓名</th>
                    <th>角色</th>
                    <th>邮箱</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {volist name="users" id="user"}
                <tr>
                    <td>{{$user['id']}}</td>
                    <td>{{$user['username']}}</td>
                    <td>{{$user['full_name'] ?? '-'}}</td>
                    <td>
                        {volist name="user.roles" id="role"}
                        <span class="layui-badge layui-bg-blue">{{$role['name']}}</span>
                        {/volist}
                    </td>
                    <td>{{$user['email'] ?? '-'}}</td>
                    <td>
                        {if $user['is_active']}
                        <span class="layui-badge layui-bg-green">启用</span>
                        {else/}
                        <span class="layui-badge layui-bg-gray">禁用</span>
                        {/if}
                    </td>
                    <td>
                        <a href="/admin/users/{{$user['id']}}/edit" class="layui-btn layui-btn-xs">编辑</a>
                        {if $user['id'] != $adminUser['id']}
                        <form method="post" action="/admin/users/{{$user['id']}}/delete" style="display:inline;" onsubmit="return confirm('确定删除该用户？')">
                            <button type="submit" class="layui-btn layui-btn-xs layui-btn-danger">删除</button>
                        </form>
                        {/if}
                    </td>
                </tr>
                {/volist}
            </tbody>
        </table>

        {if $users instanceof \Illuminate\Contracts\Pagination\LengthAwarePaginator && $users->lastPage() > 1}
        <div id="pager"></div>
        {/if}
    </div>
</div>
{/block}

{block name="script"}
<script>
{if $users instanceof \Illuminate\Contracts\Pagination\LengthAwarePaginator && $users->lastPage() > 1}
layui.use('laypage', function(){
    layui.laypage.render({
        elem: 'pager',
        count: {{$users->total()}},
        curr: {{$users->currentPage()}},
        limit: {{$users->perPage()}},
        jump: function(obj, first){
            if(!first){
                var url = new URL(window.location);
                url.searchParams.set('page', obj.curr);
                window.location = url;
            }
        }
    });
});
{/if}
</script>
{/block}
